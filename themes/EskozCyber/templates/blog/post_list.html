{% extends 'base.html' %}
{% load i18n %}
{% block title %} - {{ post_type_trans }}{% endblock %}
    {% block SEO %}
    <meta property="og:type" content="website" />
    {% endblock %}
{% block content %}
    <div class="article_list">
    <div class="article_list--top">
        <h2 class="article_list--title">{{ post_type_trans }}</h2>
        <select class="article_list--select" id='category-selector'>
            <option value="">{% trans 'All' %}</option>
            {% for category in categories %}
                {% if selected_category == category%}
                    <option value="{{category.slug}}" selected>{{category.get_translation.title|default:category.title}}</option>
                {% else %}
                    <option value="{{category.slug}}">{{category.get_translation.title|default:category.title}}</option>
                {% endif %}
            {% endfor %}
        </select>
    </div>
        {% if not posts %}
        <h2 class="message-wrapper"></h2>
            {% blocktrans with post_type=post_type %}
                There is no {{ post_type }} at the moment.
            {% endblocktrans %}
        </h2>
        {% else %}    
            {% for post in posts.all|dictsortreversed:"published_on" %}      
                <a class="article_card" href="{% url detail_url_name post.slug %}">

                    <div class="article_card--top">
                        <div class="article_card--top-left">
                            <p class="article_card--title">{{ post.get_translation.title }}</p>
                        </div>
                        {% if post.category %}
                            <p class="article_card--category">{{ post.category }}</p>
                        {% endif %}
                    </div>
                    {% if post.get_translation.description %}
                        <p class="article_card--description">“{{ post.get_translation.description|default_if_none:'' }}”</p>
                    {% endif %}
                    <div class="article_card--bottom">
                        <p class="article_card--date">{{ post.published_on|date:"j F Y" }}</p>

                        <div class="article_card--tags">
                            {% for tag in post.tags.all %}
                                <p class="article_card--tag">{{ tag.title }}</p>
                            {% endfor %}
                        </div>
                    </div>
                </a>
            {% endfor %}
        {% endif %}
    </div>

<script>
    const categorySelector = document.getElementById('category-selector');
    categorySelector.addEventListener('change', function () {
        const selectedCategory = this.value;
        if (selectedCategory) {
            window.location.href = `/{{ post_type }}/${selectedCategory}`;
        } else {
            window.location.href = `/{{ post_type }}/`;
        }
    });
</script>
{% endblock %}