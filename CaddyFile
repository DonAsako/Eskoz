{
	email {env.EMAIL}
}

{env.DOMAIN} {
	encode zstd gzip

	header {
		Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
		X-Content-Type-Options "nosniff"
		X-Frame-Options "SAMEORIGIN"
		Referrer-Policy "strict-origin-when-cross-origin"
		-Server
	}

	handle /static/* {
		uri strip_prefix /static
		root * /app/staticfiles
		header Cache-Control "public, max-age=31536000, immutable"
		file_server
	}

	handle /media/* {
		uri strip_prefix /media
		root * /app/media
		header Cache-Control "public, max-age=86400"
		file_server
	}

	handle {
		reverse_proxy web:8000 {
			header_up X-Real-IP {remote_host}
			header_up X-Forwarded-For {remote_host}
			header_up X-Forwarded-Proto {scheme}
			header_up Host {host}
		}
	}
}
